‚úÖ O que voc√™ vai fazer

Objetivo: Sua API vai enviar o PDF gerado diretamente para a sua conta do Google Drive, e retornar o link de visualiza√ß√£o/download para voc√™ (e para o GPT).

üß© O que voc√™ precisa para isso funcionar:
1. Criar um projeto na Google Cloud Console

Para ativar a API do Google Drive e gerar credenciais.

2. Obter um arquivo credentials.json

Com as chaves que permitem sua aplica√ß√£o acessar seu Google Drive.

3. Usar uma biblioteca Python chamada pydrive ou google-api-python-client

Que permite a API fazer o upload para o Google Drive.

üõ†Ô∏è PASSO A PASSO DETALHADO
‚úÖ PASSO 1 ‚Äî Criar projeto na Google Cloud

V√° para: https://console.cloud.google.com/

Fa√ßa login com a conta do Google que vai receber os PDFs

Clique em "Select project" (ou "Novo Projeto")

Crie um novo projeto:

Nome: questoes-api ou qualquer nome

Clique em "Create"

‚úÖ PASSO 2 ‚Äî Ativar a Google Drive API

Com o projeto aberto, v√° para:

https://console.cloud.google.com/apis/library/drive.googleapis.com

Clique em "Enable"

‚úÖ PASSO 3 ‚Äî Criar credenciais OAuth

V√° para: https://console.cloud.google.com/apis/credentials

Clique em ‚Äú+ CREATE CREDENTIALS‚Äù ‚Üí ‚ÄúOAuth client ID‚Äù

Se pedir para configurar uma tela de consentimento:

Escolha ‚ÄúExternal‚Äù

Preencha o nome da aplica√ß√£o (ex: "API de Quest√µes")

Salve e continue (n√£o precisa preencher escopo ainda)

Depois, crie o OAuth Client:

Tipo: Desktop

Nome: questoes-api

Ao final, clique em ‚ÄúDownload JSON‚Äù

Este √© seu credentials.json ‚Äî ele permite que a aplica√ß√£o acesse seu Drive (com sua permiss√£o).

‚úÖ PASSO 4 ‚Äî Instalar bibliotecas no Replit

No terminal, instale:

pip install google-api-python-client google-auth-httplib2 google-auth-oauthlib

‚úÖ PASSO 5 ‚Äî Criar o arquivo drive.py
import os
import pickle
from google_auth_oauthlib.flow import InstalledAppFlow
from googleapiclient.discovery import build
from googleapiclient.http import MediaFileUpload

# escopo de acesso ao Google Drive
SCOPES = ['https://www.googleapis.com/auth/drive.file']

def autenticar_drive():
    creds = None
    if os.path.exists('token.pickle'):
        with open('token.pickle', 'rb') as token:
            creds = pickle.load(token)

    if not creds or not creds.valid:
        flow = InstalledAppFlow.from_client_secrets_file('credentials.json', SCOPES)
        creds = flow.run_local_server(port=0)
        with open('token.pickle', 'wb') as token:
            pickle.dump(creds, token)

    return build('drive', 'v3', credentials=creds)

def upload_para_drive(nome_arquivo):
    service = autenticar_drive()
    arquivo = MediaFileUpload(nome_arquivo, mimetype='application/pdf')
    
    file_metadata = {
        'name': nome_arquivo,
        'mimeType': 'application/pdf'
    }

    file = service.files().create(body=file_metadata, media_body=arquivo, fields='id').execute()

    # gerar link de compartilhamento
    file_id = file.get('id')
    service.permissions().create(
        fileId=file_id,
        body={'type': 'anyone', 'role': 'reader'}
    ).execute()

    link = f"https://drive.google.com/file/d/{file_id}/view"
    return link

‚úÖ PASSO 6 ‚Äî Usar no seu main.py

Substitua esta linha:

pdf_url = f"https://meu-pdf.fake/{pdf_path}"


Por:

if req.salvarNoDrive:
    pdf_url = upload_para_drive(pdf_path)
else:
    pdf_url = f"https://seuservidor.com/{pdf_path}"  # local

üß™ PRIMEIRA VEZ: vai abrir o navegador

Quando voc√™ rodar isso pela primeira vez no Replit (ou localmente), a fun√ß√£o run_local_server vai abrir uma aba no navegador pra voc√™ autorizar o acesso √† sua conta Google.

Depois disso, um arquivo token.pickle ser√° salvo ‚Äî que mant√©m o login.

No Render, essa parte precisa ser adaptada (vou te ajudar se for usar l√° depois).

‚úÖ Resultado

Agora, quando o GPT chamar sua API com "salvarNoDrive": true, o PDF ser√°:

Gerado com as quest√µes

Enviado direto para o seu Google Drive

Com um link de visualiza√ß√£o p√∫blico como:

https://drive.google.com/file/d/1ABCxyz/view

‚úÖ Exemplo de uso final da API (JSON enviado):
{
  "volume": 1,
  "topico": "Defini√ß√µes de Conjuntos",
  "quantidade": 80,
  "salvarNoDrive": true
}

‚ö†Ô∏è Seguran√ßa: esse acesso ao Drive √© s√≥ seu

A API n√£o acessa nada sem sua permiss√£o

Voc√™ pode revogar o token a qualquer momento

O link do PDF √© compartilh√°vel apenas se voc√™ quiser

üéÅ Quer que eu te envie esse drive.py e credentials.json exemplo?

N√£o posso te enviar seu credentials.json (isso s√≥ voc√™ pode gerar, com sua conta), mas posso te dar todos os arquivos prontos e o script funcionando.

Pr√≥ximo passo?

Me diga:

Voc√™ est√° testando no Replit agora?

J√° criou o credentials.json na Google Cloud?

Quer que eu envie um ZIP com tudo organizado?

Posso montar tudo pra voc√™ s√≥ subir.

S√≥ me dizer.